<strong>Update:</strong> In response to a query from the OP in the comments, here is an expansion of the first step.
First, note that the vector chain rule requires summations (see <a href="https://en.wikipedia.org/wiki/Chain_rule#Higher_dimensions" rel="noreferrer">here</a>). Second, to be certain of getting <em>all</em> gradient components, you should always introduce a <em>new</em> subscript letter for the component in the denominator of the partial derivative. So to fully write out the gradient with the full chain rule, we have
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-80-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mfrac><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><mi>E</mi></mrow><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><msub><mi>w</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>p</mi><mi>q</mi></mrow></msub></mrow></mfrac><mo>=</mo><munder><mo>&amp;#x2211;</mo><mi>i</mi></munder><mfrac><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><mi>E</mi></mrow><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><msub><mi>o</mi><mi>i</mi></msub></mrow></mfrac><mfrac><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><msub><mi>o</mi><mi>i</mi></msub></mrow><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><msub><mi>w</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>p</mi><mi>q</mi></mrow></msub></mrow></mfrac></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1230" style="width: 11.447em; display: inline-block;"><span style="display: inline-block; position: relative; height: 0px; font-size: 120%; width: 9.5em;"><span style="position: absolute; clip: rect(0.72em, 1009.5em, 3.636em, -1000em); top: -2.278em; left: 0em;"><span class="mrow" id="MathJax-Span-1231"><span class="mfrac" id="MathJax-Span-1232"><span style="display: inline-block; position: relative; height: 0px; width: 2.158em; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.118em, 1001.33em, 4.189em, -1000em); top: -4.677em; left: 50%; margin-left: -0.665em;"><span class="mrow" id="MathJax-Span-1233"><span class="mi" id="MathJax-Span-1234" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="mi" id="MathJax-Span-1235" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(3.118em, 1002.04em, 4.454em, -1000em); top: -3.306em; left: 50%; margin-left: -1.019em;"><span class="mrow" id="MathJax-Span-1236"><span class="mi" id="MathJax-Span-1237" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-1238"><span style="display: inline-block; position: relative; height: 0px; width: 1.472em;"><span style="position: absolute; clip: rect(3.39em, 1000.69em, 4.178em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1239" style="font-family: MathJax_Math; font-style: italic;">w</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.716em;"><span class="texatom" id="MathJax-Span-1240"><span class="mrow" id="MathJax-Span-1241"><span class="mi" id="MathJax-Span-1242" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-1243" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.01em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(0.819em, 1002.16em, 1.222em, -1000em); top: -1.276em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.158em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.056em;"></span></span></span></span><span class="mo" id="MathJax-Span-1244" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="munderover" id="MathJax-Span-1245" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; height: 0px; width: 1.444em;"><span style="position: absolute; clip: rect(2.883em, 1001.39em, 4.617em, -1000em); top: -4em; left: 0em;"><span class="mo" id="MathJax-Span-1246" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(3.366em, 1000.21em, 4.274em, -1000em); top: -2.916em; left: 0.6em;"><span class="mi" id="MathJax-Span-1247" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span><span class="mfrac" id="MathJax-Span-1248" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; height: 0px; width: 1.49em; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.118em, 1001.33em, 4.189em, -1000em); top: -4.677em; left: 50%; margin-left: -0.665em;"><span class="mrow" id="MathJax-Span-1249"><span class="mi" id="MathJax-Span-1250" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="mi" id="MathJax-Span-1251" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(3.118em, 1001.37em, 4.324em, -1000em); top: -3.306em; left: 50%; margin-left: -0.685em;"><span class="mrow" id="MathJax-Span-1252"><span class="mi" id="MathJax-Span-1253" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-1254"><span style="display: inline-block; position: relative; height: 0px; width: 0.804em;"><span style="position: absolute; clip: rect(3.392em, 1000.48em, 4.178em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1255" style="font-family: MathJax_Math; font-style: italic;">o</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.485em;"><span class="mi" id="MathJax-Span-1256" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(0.819em, 1001.49em, 1.222em, -1000em); top: -1.276em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.49em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.056em;"></span></span></span></span><span class="mfrac" id="MathJax-Span-1257"><span style="display: inline-block; position: relative; height: 0px; width: 2.158em; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.118em, 1001.37em, 4.324em, -1000em); top: -4.677em; left: 50%; margin-left: -0.685em;"><span class="mrow" id="MathJax-Span-1258"><span class="mi" id="MathJax-Span-1259" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-1260"><span style="display: inline-block; position: relative; height: 0px; width: 0.804em;"><span style="position: absolute; clip: rect(3.392em, 1000.48em, 4.178em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1261" style="font-family: MathJax_Math; font-style: italic;">o</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.485em;"><span class="mi" id="MathJax-Span-1262" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(3.118em, 1002.04em, 4.454em, -1000em); top: -3.306em; left: 50%; margin-left: -1.019em;"><span class="mrow" id="MathJax-Span-1263"><span class="mi" id="MathJax-Span-1264" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-1265"><span style="display: inline-block; position: relative; height: 0px; width: 1.472em;"><span style="position: absolute; clip: rect(3.39em, 1000.69em, 4.178em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1266" style="font-family: MathJax_Math; font-style: italic;">w</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.716em;"><span class="texatom" id="MathJax-Span-1267"><span class="mrow" id="MathJax-Span-1268"><span class="mi" id="MathJax-Span-1269" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-1270" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.01em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(0.819em, 1002.16em, 1.222em, -1000em); top: -1.276em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.158em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.056em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.278em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.497em; border-left: 0px solid; width: 0px; height: 3.233em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-80">\frac{\partial E}{\partial w_{pq}}=\sum_i \frac{\partial E}{\partial o_i}\frac{\partial o_i}{\partial w_{pq}}</script>
and
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-81-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mfrac><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><msub><mi>o</mi><mi>i</mi></msub></mrow><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><msub><mi>w</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>p</mi><mi>q</mi></mrow></msub></mrow></mfrac><mo>=</mo><munder><mo>&amp;#x2211;</mo><mi>k</mi></munder><mfrac><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><msub><mi>o</mi><mi>i</mi></msub></mrow><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><msub><mi>z</mi><mi>k</mi></msub></mrow></mfrac><mfrac><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><msub><mi>z</mi><mi>k</mi></msub></mrow><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><msub><mi>w</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>p</mi><mi>q</mi></mrow></msub></mrow></mfrac></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1271" style="width: 11.503em; display: inline-block;"><span style="display: inline-block; position: relative; height: 0px; font-size: 120%; width: 9.556em;"><span style="position: absolute; clip: rect(0.72em, 1009.56em, 3.66em, -1000em); top: -2.278em; left: 0em;"><span class="mrow" id="MathJax-Span-1272"><span class="mfrac" id="MathJax-Span-1273"><span style="display: inline-block; position: relative; height: 0px; width: 2.158em; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.118em, 1001.37em, 4.324em, -1000em); top: -4.677em; left: 50%; margin-left: -0.685em;"><span class="mrow" id="MathJax-Span-1274"><span class="mi" id="MathJax-Span-1275" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-1276"><span style="display: inline-block; position: relative; height: 0px; width: 0.804em;"><span style="position: absolute; clip: rect(3.392em, 1000.48em, 4.178em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1277" style="font-family: MathJax_Math; font-style: italic;">o</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.485em;"><span class="mi" id="MathJax-Span-1278" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(3.118em, 1002.04em, 4.454em, -1000em); top: -3.306em; left: 50%; margin-left: -1.019em;"><span class="mrow" id="MathJax-Span-1279"><span class="mi" id="MathJax-Span-1280" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-1281"><span style="display: inline-block; position: relative; height: 0px; width: 1.472em;"><span style="position: absolute; clip: rect(3.39em, 1000.69em, 4.178em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1282" style="font-family: MathJax_Math; font-style: italic;">w</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.716em;"><span class="texatom" id="MathJax-Span-1283"><span class="mrow" id="MathJax-Span-1284"><span class="mi" id="MathJax-Span-1285" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-1286" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.01em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(0.819em, 1002.16em, 1.222em, -1000em); top: -1.276em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.158em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.056em;"></span></span></span></span><span class="mo" id="MathJax-Span-1287" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="munderover" id="MathJax-Span-1288" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; height: 0px; width: 1.444em;"><span style="position: absolute; clip: rect(2.883em, 1001.39em, 4.617em, -1000em); top: -4em; left: 0em;"><span class="mo" id="MathJax-Span-1289" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(3.343em, 1000.36em, 4.274em, -1000em); top: -2.893em; left: 0.538em;"><span class="mi" id="MathJax-Span-1290" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">k</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span><span class="mfrac" id="MathJax-Span-1291" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; height: 0px; width: 1.594em; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.118em, 1001.37em, 4.324em, -1000em); top: -4.677em; left: 50%; margin-left: -0.685em;"><span class="mrow" id="MathJax-Span-1292"><span class="mi" id="MathJax-Span-1293" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-1294"><span style="display: inline-block; position: relative; height: 0px; width: 0.804em;"><span style="position: absolute; clip: rect(3.392em, 1000.48em, 4.178em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1295" style="font-family: MathJax_Math; font-style: italic;">o</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.485em;"><span class="mi" id="MathJax-Span-1296" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(3.118em, 1001.47em, 4.324em, -1000em); top: -3.306em; left: 50%; margin-left: -0.737em;"><span class="mrow" id="MathJax-Span-1297"><span class="mi" id="MathJax-Span-1298" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-1299"><span style="display: inline-block; position: relative; height: 0px; width: 0.908em;"><span style="position: absolute; clip: rect(3.391em, 1000.47em, 4.178em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1300" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.465em;"><span class="mi" id="MathJax-Span-1301" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">k</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(0.819em, 1001.59em, 1.222em, -1000em); top: -1.276em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.594em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.056em;"></span></span></span></span><span class="mfrac" id="MathJax-Span-1302"><span style="display: inline-block; position: relative; height: 0px; width: 2.158em; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.118em, 1001.47em, 4.324em, -1000em); top: -4.677em; left: 50%; margin-left: -0.737em;"><span class="mrow" id="MathJax-Span-1303"><span class="mi" id="MathJax-Span-1304" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-1305"><span style="display: inline-block; position: relative; height: 0px; width: 0.908em;"><span style="position: absolute; clip: rect(3.391em, 1000.47em, 4.178em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1306" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.465em;"><span class="mi" id="MathJax-Span-1307" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">k</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(3.118em, 1002.04em, 4.454em, -1000em); top: -3.306em; left: 50%; margin-left: -1.019em;"><span class="mrow" id="MathJax-Span-1308"><span class="mi" id="MathJax-Span-1309" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-1310"><span style="display: inline-block; position: relative; height: 0px; width: 1.472em;"><span style="position: absolute; clip: rect(3.39em, 1000.69em, 4.178em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1311" style="font-family: MathJax_Math; font-style: italic;">w</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.716em;"><span class="texatom" id="MathJax-Span-1312"><span class="mrow" id="MathJax-Span-1313"><span class="mi" id="MathJax-Span-1314" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-1315" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.01em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(0.819em, 1002.16em, 1.222em, -1000em); top: -1.276em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.158em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.056em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.278em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.525em; border-left: 0px solid; width: 0px; height: 3.261em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-81">\frac{\partial o_i}{\partial w_{pq}}=\sum_k \frac{\partial o_i}{\partial z_k}\frac{\partial z_k}{\partial w_{pq}}</script>
so
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-82-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mfrac><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><mi>E</mi></mrow><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><msub><mi>w</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>p</mi><mi>q</mi></mrow></msub></mrow></mfrac><mo>=</mo><munder><mo>&amp;#x2211;</mo><mi>i</mi></munder><mrow><mo>[</mo><mfrac><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><mi>E</mi></mrow><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><msub><mi>o</mi><mi>i</mi></msub></mrow></mfrac><mrow><mo>(</mo><munder><mo>&amp;#x2211;</mo><mi>k</mi></munder><mfrac><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><msub><mi>o</mi><mi>i</mi></msub></mrow><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><msub><mi>z</mi><mi>k</mi></msub></mrow></mfrac><mfrac><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><msub><mi>z</mi><mi>k</mi></msub></mrow><mrow><mi mathvariant=&quot;normal&quot;>&amp;#x2202;</mi><msub><mi>w</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>p</mi><mi>q</mi></mrow></msub></mrow></mfrac><mo>)</mo></mrow><mo>]</mo></mrow></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1316" style="width: 18.836em; display: inline-block;"><span style="display: inline-block; position: relative; height: 0px; font-size: 120%; width: 15.667em;"><span style="position: absolute; clip: rect(2.084em, 1015.4em, 5.416em, -1000em); top: -4em; left: 0em;"><span class="mrow" id="MathJax-Span-1317"><span class="mfrac" id="MathJax-Span-1318"><span style="display: inline-block; position: relative; height: 0px; width: 2.158em; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.118em, 1001.33em, 4.189em, -1000em); top: -4.677em; left: 50%; margin-left: -0.665em;"><span class="mrow" id="MathJax-Span-1319"><span class="mi" id="MathJax-Span-1320" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="mi" id="MathJax-Span-1321" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(3.118em, 1002.04em, 4.454em, -1000em); top: -3.306em; left: 50%; margin-left: -1.019em;"><span class="mrow" id="MathJax-Span-1322"><span class="mi" id="MathJax-Span-1323" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-1324"><span style="display: inline-block; position: relative; height: 0px; width: 1.472em;"><span style="position: absolute; clip: rect(3.39em, 1000.69em, 4.178em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1325" style="font-family: MathJax_Math; font-style: italic;">w</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.716em;"><span class="texatom" id="MathJax-Span-1326"><span class="mrow" id="MathJax-Span-1327"><span class="mi" id="MathJax-Span-1328" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-1329" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.01em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(0.819em, 1002.16em, 1.222em, -1000em); top: -1.276em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.158em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.056em;"></span></span></span></span><span class="mo" id="MathJax-Span-1330" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="munderover" id="MathJax-Span-1331" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; height: 0px; width: 1.444em;"><span style="position: absolute; clip: rect(2.883em, 1001.39em, 4.617em, -1000em); top: -4em; left: 0em;"><span class="mo" id="MathJax-Span-1332" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(3.366em, 1000.21em, 4.274em, -1000em); top: -2.916em; left: 0.6em;"><span class="mi" id="MathJax-Span-1333" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span><span class="mrow" id="MathJax-Span-1334" style="padding-left: 0.167em;"><span class="mo" id="MathJax-Span-1335" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">[</span></span><span class="mfrac" id="MathJax-Span-1336"><span style="display: inline-block; position: relative; height: 0px; width: 1.49em; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.118em, 1001.33em, 4.189em, -1000em); top: -4.677em; left: 50%; margin-left: -0.665em;"><span class="mrow" id="MathJax-Span-1337"><span class="mi" id="MathJax-Span-1338" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="mi" id="MathJax-Span-1339" style="font-family: MathJax_Math; font-style: italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.026em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(3.118em, 1001.37em, 4.324em, -1000em); top: -3.306em; left: 50%; margin-left: -0.685em;"><span class="mrow" id="MathJax-Span-1340"><span class="mi" id="MathJax-Span-1341" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-1342"><span style="display: inline-block; position: relative; height: 0px; width: 0.804em;"><span style="position: absolute; clip: rect(3.392em, 1000.48em, 4.178em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1343" style="font-family: MathJax_Math; font-style: italic;">o</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.485em;"><span class="mi" id="MathJax-Span-1344" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(0.819em, 1001.49em, 1.222em, -1000em); top: -1.276em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.49em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.056em;"></span></span></span></span><span class="mrow" id="MathJax-Span-1345"><span class="mo" id="MathJax-Span-1346" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">(</span></span><span class="munderover" id="MathJax-Span-1347"><span style="display: inline-block; position: relative; height: 0px; width: 1.444em;"><span style="position: absolute; clip: rect(2.883em, 1001.39em, 4.617em, -1000em); top: -4em; left: 0em;"><span class="mo" id="MathJax-Span-1348" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(3.343em, 1000.36em, 4.274em, -1000em); top: -2.893em; left: 0.538em;"><span class="mi" id="MathJax-Span-1349" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">k</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span><span class="mfrac" id="MathJax-Span-1350" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; height: 0px; width: 1.594em; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.118em, 1001.37em, 4.324em, -1000em); top: -4.677em; left: 50%; margin-left: -0.685em;"><span class="mrow" id="MathJax-Span-1351"><span class="mi" id="MathJax-Span-1352" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-1353"><span style="display: inline-block; position: relative; height: 0px; width: 0.804em;"><span style="position: absolute; clip: rect(3.392em, 1000.48em, 4.178em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1354" style="font-family: MathJax_Math; font-style: italic;">o</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.485em;"><span class="mi" id="MathJax-Span-1355" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(3.118em, 1001.47em, 4.324em, -1000em); top: -3.306em; left: 50%; margin-left: -0.737em;"><span class="mrow" id="MathJax-Span-1356"><span class="mi" id="MathJax-Span-1357" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-1358"><span style="display: inline-block; position: relative; height: 0px; width: 0.908em;"><span style="position: absolute; clip: rect(3.391em, 1000.47em, 4.178em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1359" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.465em;"><span class="mi" id="MathJax-Span-1360" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">k</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(0.819em, 1001.59em, 1.222em, -1000em); top: -1.276em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.594em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.056em;"></span></span></span></span><span class="mfrac" id="MathJax-Span-1361"><span style="display: inline-block; position: relative; height: 0px; width: 2.158em; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.118em, 1001.47em, 4.324em, -1000em); top: -4.677em; left: 50%; margin-left: -0.737em;"><span class="mrow" id="MathJax-Span-1362"><span class="mi" id="MathJax-Span-1363" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-1364"><span style="display: inline-block; position: relative; height: 0px; width: 0.908em;"><span style="position: absolute; clip: rect(3.391em, 1000.47em, 4.178em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1365" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.465em;"><span class="mi" id="MathJax-Span-1366" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">k</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(3.118em, 1002.04em, 4.454em, -1000em); top: -3.306em; left: 50%; margin-left: -1.019em;"><span class="mrow" id="MathJax-Span-1367"><span class="mi" id="MathJax-Span-1368" style="font-family: MathJax_Main;">∂<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.035em;"></span></span><span class="msubsup" id="MathJax-Span-1369"><span style="display: inline-block; position: relative; height: 0px; width: 1.472em;"><span style="position: absolute; clip: rect(3.39em, 1000.69em, 4.178em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1370" style="font-family: MathJax_Math; font-style: italic;">w</span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.716em;"><span class="texatom" id="MathJax-Span-1371"><span class="mrow" id="MathJax-Span-1372"><span class="mi" id="MathJax-Span-1373" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">p</span><span class="mi" id="MathJax-Span-1374" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.01em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; clip: rect(0.819em, 1002.16em, 1.222em, -1000em); top: -1.276em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.158em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.056em;"></span></span></span></span><span class="mo" id="MathJax-Span-1375" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">)</span></span></span><span class="mo" id="MathJax-Span-1376" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">]</span></span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.566em; border-left: 0px solid; width: 0px; height: 3.732em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-82">\frac{\partial E}{\partial w_{pq}}=\sum_i \left[ \frac{\partial E}{\partial o_i}\left(\sum_k \frac{\partial o_i}{\partial z_k}\frac{\partial z_k}{\partial w_{pq}}\right) \right]</script>
In practice the full summations reduce, because you get a lot of <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-83-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>&amp;#x03B4;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>a</mi><mi>b</mi></mrow></msub></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1377" style="width: 1.503em; display: inline-block;"><span style="display: inline-block; position: relative; height: 0px; font-size: 120%; width: 1.222em;"><span style="position: absolute; clip: rect(1.339em, 1001.22em, 2.547em, -1000em); top: -2.222em; left: 0em;"><span class="mrow" id="MathJax-Span-1378"><span class="msubsup" id="MathJax-Span-1379"><span style="display: inline-block; position: relative; height: 0px; width: 1.196em;"><span style="position: absolute; clip: rect(3.116em, 1000.45em, 4.177em, -1000em); top: -4em; left: 0em;"><span class="mi" id="MathJax-Span-1380" style="font-family: MathJax_Math; font-style: italic;">δ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.007em;"></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.444em;"><span class="texatom" id="MathJax-Span-1381"><span class="mrow" id="MathJax-Span-1382"><span class="mi" id="MathJax-Span-1383" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">a</span><span class="mi" id="MathJax-Span-1384" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">b</span></span></span><span style="display: inline-block; width: 0px; height: 4em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.222em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.256em; border-left: 0px solid; width: 0px; height: 1.183em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-83">\delta_{ab}</script> terms. Although it involves a lot of perhaps "extra" summations and subscripts, using the full chain rule will ensure you always get the correct result.
